type: vertical-stack
cards:
  - type: markdown
    content: >
      <small> {% set updates = [
        states.sensor.water_quality_ph.last_updated,
        states.sensor.water_quality_oxidation_reduction_potential.last_updated,
        states.sensor.water_quality_Temperature.last_updated,
        states.sensor.water_quality_total_dissolved_solids.last_updated,
        states.sensor.water_quality_electrical_conductivity.last_updated,
        states.sensor.water_quality_salinity.last_updated,
        states.sensor.water_quality_specific_gravity.last_updated
      ] %} {% set last = updates | max %} {% set now = now() %} {% set
      minutes = ((now - last).total_seconds() / 60) | round(0) %}

      Latest data update:   {{ last.strftime('%Y-%m-%d %H:%M') }}
      (does {{ minutes }} minute{{ 's' if minutes != 1 }}) </small>
    card_mod:
      style: |
        ha-markdown {
          font-size: 12px;
          color: gray;
          text-align: center;
          margin-bottom: 10px;
        }
  - type: grid
    columns: 2
    square: false
    cards:
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set ph = states('sensor.water_quality_ph') %} {% if ph in
              ['unknown', 'unavailable', 'none'] %}
                {% set ph = states('input_number.ph_last_valid') | float %}
              {% else %}
                {% set ph = ph | float %}
              {% endif %} {% if ph < 7 %}
                游 **ALERT:** The value of **pH** is **low** ({{ ph }}).
              {% elif ph > 7.8 %}
                游댮 **ALERT:** The value of **pH** is **high** ({{ ph }}).
              {% else %}
                游릭 **pH within the optimal range** ({{ ph }})
              {% endif %}
          - type: custom:mini-graph-card
            name: pH
            entities:
              - sensor.water_quality_ph
            line_color: "#33ff99"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set orp =
              states('sensor.water_quality_oxidation_reduction_potential') %} {%
              if orp in ['unknown', 'unavailable', 'none'] %}
                {% set orp = states('input_number.orp_last_valid') | float %}
              {% else %}
                {% set orp = orp | float %}
              {% endif %} {% if orp < 650 %}
                游 **ALERT:** ORP low ({{ orp }} mV)
              {% elif orp > 750 %}
                游댮 **ALERT:** ORP very high ({{ orp }} mV)
              {% else %}
                游릭 **ORP within the correct range** ({{ orp }} mV)
              {% endif %}
          - type: custom:mini-graph-card
            name: ORP (Redox)
            entities:
              - sensor.water_quality_oxidation_reduction_potential
            line_color: "#ffd633"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set temp = states('sensor.water_quality_Temperature') %} {% if
              temp in ['unknown', 'unavailable', 'none'] %}
                {% set temp = states('input_number.Temperature_last_valid') | float %}
              {% else %}
                {% set temp = temp | float %}
              {% endif %} {% if temp < 22 %}
                游 **Temperature low** ({{ temp }}춿C)
              {% elif temp > 32 %}
                游댮 **Temperature high** ({{ temp }}춿C)
              {% else %}
                游릭 **Temperature correct** ({{ temp }}춿C)
              {% endif %}
          - type: custom:mini-graph-card
            name: Water Temperature
            entities:
              - sensor.water_quality_Temperature
            line_color: "#ff3366"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set tds = states('sensor.water_quality_total_dissolved_solids')
              %} {% if tds in ['unknown', 'unavailable', 'none'] %}
                {% set tds = states('input_number.tds_last_valid') | float %}
              {% else %}
                {% set tds = tds | float %}
              {% endif %} {% if tds < 3000 %}
                游 **TDS low** ({{ tds }} ppm)
              {% elif tds > 6000 %}
                游댮 **TDS high** ({{ tds }} ppm)
              {% else %}
                游릭 **TDS within the acceptable range** ({{ tds }} ppm)
              {% endif %}
          - type: custom:mini-graph-card
            name: TDS (Dissolved Solids)
            entities:
              - sensor.water_quality_total_dissolved_solids
            line_color: "#ffff66"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set ec = states('sensor.water_quality_electrical_conductivity')
              %} {% if ec in ['unknown', 'unavailable', 'none'] %}
                {% set ec = states('input_number.conductivity_last_valid') | float %}
              {% else %}
                {% set ec = ec | float %}
              {% endif %} {% if ec < 5000 %}
                游 **conductivity low** ({{ ec }} 췃S/cm)
              {% elif ec > 12000 %}
                游댮 **conductivity high** ({{ ec }} 췃S/cm)
              {% else %}
                游릭 **conductivity in range** ({{ ec }} 췃S/cm)
              {% endif %}
          - type: custom:mini-graph-card
            name: conductivity (췃S/cm)
            entities:
              - sensor.water_quality_electrical_conductivity
            line_color: "#cccccc"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set sal = states('sensor.water_quality_salinity') %} {% if sal
              in ['unknown', 'unavailable', 'none'] %}
                {% set sal = states('input_number.salinity_last_valid') | float %}
              {% else %}
                {% set sal = sal | float %}
              {% endif %} {% if sal < 3500 %}
                游 **salinity low** ({{ sal }} ppm)
              {% elif sal > 7000 %}
                游댮 **salinity high** ({{ sal }} ppm)
              {% else %}
                游릭 **salinity correct** ({{ sal }} ppm)
              {% endif %}
          - type: custom:mini-graph-card
            name: salinity (ppm)
            entities:
              - sensor.water_quality_salinity
            line_color: "#ff884d"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
      - type: vertical-stack
        cards:
          - type: markdown
            content: >
              {% set sg = states('sensor.water_quality_specific_gravity') %} {%
              if sg in ['unknown', 'unavailable', 'none'] %}
                {% set sg = states('input_number.densidad_last_valid') | float %}
              {% else %}
                {% set sg = sg | float %}
              {% endif %} {% if sg < 0.995 %}
                游 **Specific gravity low** ({{ sg }})
              {% elif sg > 1.005 %}
                游댮 **Specific gravity high** ({{ sg }})
              {% else %}
                游릭 **Specific gravity in range** ({{ sg }})
              {% endif %}
          - type: custom:mini-graph-card
            name: Specific Gravity (SG)
            entities:
              - sensor.water_quality_specific_gravity
            line_color: "#66ccff"
            line_width: 4
            font_size: 90
            hours_to_show: 24
            points_per_hour: 6
            show:
              extrema: true
              icon: false
              fill: fade
